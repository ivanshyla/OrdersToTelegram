# ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï - –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞ **–ª–æ–∂–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞—Ö, –∫–æ–≥–¥–∞ –≤—Å–µ –∑–∞–∫–∞–∑—ã –±—ã–ª–∏ —É–∂–µ —Ä–∞–∑–æ–±—Ä–∞–Ω—ã.

## üîç –ü—Ä–∏—á–∏–Ω–∞

–ü–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π –≤—ã—è—Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ **"–Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã"** –≤ CRM –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫:

**–ö–†–ê–°–ù–´–ô BADGE —Å —Ü–∏—Ñ—Ä–æ–π –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–∞—Ç—ã** ‚Üê —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç—ã.

### ‚ùå –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–ª–æ:

1. **–ñ–µ–ª—Ç–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ** "–ï—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã" - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –í–°–ï–• –¥–∞—Ç, –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π
2. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–∏—Å–µ–ª** "–ö–æ–ª-–≤–æ –∑–∞–∫–∞–∑–æ–≤" vs "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã" - —ç—Ç–æ –Ω–µ —Ç–æ –∂–µ —Å–∞–º–æ–µ —á—Ç–æ "—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã–µ"

### ‚úÖ –ß—Ç–æ –†–ê–ë–û–¢–ê–ï–¢:

**–ü–æ–∏—Å–∫ –∫—Ä–∞—Å–Ω–æ–≥–æ badge –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç—ã**

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ

### –ê–ª–≥–æ—Ä–∏—Ç–º –≤ `badge_presence.py`:

```python
def detect_red_badge_near_date(img_bgr, date_bbox, debug=False):
    """
    –ò—â–µ–º –ö–†–ê–°–ù–´–ô BADGE –° –¶–ò–§–†–û–ô —Ä—è–¥–æ–º —Å –¥–∞—Ç–æ–π.
    –≠—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –ö–û–ù–ö–†–ï–¢–ù–û–ô –¥–∞—Ç—ã.
    """
    # –û–±–ª–∞—Å—Ç—å –ø–æ–∏—Å–∫–∞: –ü–†–ê–í–´–ô –í–ï–†–•–ù–ò–ô –£–ì–û–õ –∫–∞—Ä—Ç–æ—á–∫–∏
    # –ö–∞—Ä—Ç–æ—á–∫–∞ —à–∏—Ä–∏–Ω–æ–π –ø—Ä–∏–º–µ—Ä–Ω–æ 250px, –¥–∞—Ç–∞ —Å–ª–µ–≤–∞ –≤–≤–µ—Ä—Ö—É
    # Badge –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –∫–∞—Ä—Ç–æ—á–∫–∏ (–Ω–∞–ø—Ä–æ—Ç–∏–≤ –¥–∞—Ç—ã)
    card_width = 250
    search_x1 = max(0, x + card_width - 80)  # –ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª
    search_y1 = max(0, y - 10)  # –ù–∞ —É—Ä–æ–≤–Ω–µ –¥–∞—Ç—ã
    search_x2 = min(W, x + card_width + 20)
    search_y2 = min(H, y + 60)
    
    # –ò—â–µ–º –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç (HSV mask)
    hsv = cv2.cvtColor(roi, cv2.COLOR_BGR2HSV)
    m1 = cv2.inRange(hsv, np.array([0, 150, 150]), np.array([10, 255, 255]))
    m2 = cv2.inRange(hsv, np.array([170, 150, 150]), np.array([180, 255, 255]))
    red_mask = m1 | m2
    
    # –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç—É—Ä—ã, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –∏ —Ñ–æ—Ä–º—É
    # Badge –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π (300-3000 –ø–∏–∫—Å–µ–ª–µ–π), –ø—Ä–∏–º–µ—Ä–Ω–æ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π
```

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

1. **–û–±–ª–∞—Å—Ç—å –ø–æ–∏—Å–∫–∞**: –ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª –∫–∞—Ä—Ç–æ—á–∫–∏ (250px –≤–ø—Ä–∞–≤–æ –æ—Ç –¥–∞—Ç—ã)
2. **–¶–≤–µ—Ç**: –ù–∞—Å—ã—â–µ–Ω–Ω—ã–π –∫—Ä–∞—Å–Ω—ã–π (HSV —Å –≤—ã—Å–æ–∫–æ–π saturation/value)
3. **–§–æ—Ä–º–∞**: –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π, –ø—Ä–∏–º–µ—Ä–Ω–æ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π (aspect ratio 0.7-1.5)
4. **–†–∞–∑–º–µ—Ä**: 300-3000 –ø–∏–∫—Å–µ–ª–µ–π

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (21.11.2024 21:44):

```
–í–∞—Ä—à–∞–≤–∞ (22.11):
üî¥ –ù–ê–ô–î–ï–ù –ö–†–ê–°–ù–´–ô BADGE
‚Üí üì§ –û–¢–ü–†–ê–í–õ–ï–ù–û –≤ Telegram

–ë–µ—Ä–ª–∏–Ω (22.11):
‚úÖ –ö—Ä–∞—Å–Ω–æ–≥–æ badge –Ω–µ—Ç
‚Üí üì≠ –ù–ï –û–¢–ü–†–ê–í–õ–ï–ù–û
```

### ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:
- **–ù–µ—Ç –ª–æ–∂–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** –¥–ª—è –¥–∞—Ç –±–µ–∑ –Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- **–¢–æ—á–Ω–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ** –∫—Ä–∞—Å–Ω–æ–≥–æ badge –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –¥–∞—Ç
- **–†–∞–±–æ—Ç–∞–µ—Ç –≤ production** (–ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∏ GitHub Actions)

## üöÄ –î–µ–ø–ª–æ–π

### 1. –õ–æ–∫–∞–ª—å–Ω—ã–π (—á–µ—Ä–µ–∑ launchd):
```bash
cd /Users/ivanshyla/OrdersToTelegram/crm-watcher
launchctl unload ~/Library/LaunchAgents/com.cleanwhale.multi-crm-watcher.plist
launchctl load ~/Library/LaunchAgents/com.cleanwhale.multi-crm-watcher.plist
```

### 2. GitHub Actions:
–ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è –ø—Ä–∏ push –≤ `main`.
Workflow –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç (cron: `*/15 8-22 * * *`).

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:

1. `crm-watcher/badge_presence.py` - –æ—Å–Ω–æ–≤–Ω–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–µ—Ç–µ–∫—Ü–∏–∏
2. `.github/workflows/crm-monitor.yml` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ EasyOCR –º–æ–¥–µ–ª–µ–π
3. `crm-watcher/multi_crm_monitor.py` - —É–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ notification_hours –≤ check_badge_presence

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç CRM –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç (8:00-22:00) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∫—Ä–∞—Å–Ω–æ–≥–æ badge —Å –Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã–º–∏ –∑–∞–∫–∞–∑–∞–º–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç—ã.

---

**–î–∞—Ç–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 21 –Ω–æ—è–±—Ä—è 2024  
**–ö–æ–º–º–∏—Ç**: f5e8292 - "Fix: search red badge in RIGHT TOP corner of card"

