# üîç CRM Order Monitor - –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ CRM –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è **–Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤** –≤ –¥–≤—É—Ö –≥–æ—Ä–æ–¥–∞—Ö (–í–∞—Ä—à–∞–≤–∞, –ë–µ—Ä–ª–∏–Ω). –°–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–∞—à–±–æ—Ä–¥–∞ CRM, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Ö —Å –ø–æ–º–æ—â—å—é –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º.

## üéØ –ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç

–°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç **–∫—Ä–∞—Å–Ω—ã–π badge —Å —Ü–∏—Ñ—Ä–æ–π** –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–∞—Ç—ã –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ CRM. –≠—Ç–æ—Ç badge –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ **–Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤** –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç—ã.

### –ü—Ä–∏–º–µ—Ä:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 22.11          ‚îå‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ
‚îÇ                ‚îÇ 2 ‚îÇ ‚Üê BADGE‚îÇ
‚îÇ –ö–æ–ª-–≤–æ: 126    ‚îî‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ
‚îÇ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ: 126           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **`multi_crm_monitor.py`** - –≥–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä —á–µ—Ä–µ–∑ Playwright
   - –î–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–∞—à–±–æ—Ä–¥–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞
   - –í—ã–∑—ã–≤–∞–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –¥–µ—Ç–µ–∫—Ü–∏–∏
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

2. **`badge_presence.py`** - –∞–ª–≥–æ—Ä–∏—Ç–º –¥–µ—Ç–µ–∫—Ü–∏–∏
   - OCR –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–∞—Ç –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ (EasyOCR)
   - Computer Vision –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫—Ä–∞—Å–Ω–æ–≥–æ badge (OpenCV)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–∞–π–¥–µ–Ω badge –∏–ª–∏ –Ω–µ—Ç

3. **`multi_crm_config.py`** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
   - –°–ø–∏—Å–æ–∫ CRM –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ (–≥–æ—Ä–æ–¥–∞)
   - URL, credentials, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

4. **GitHub Actions** (`.github/workflows/crm-monitor.yml`)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
   - –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: 8:00-22:00 (UTC)
   - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ EasyOCR –º–æ–¥–µ–ª–µ–π

5. **Local (launchd)** - –ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–∞ Mac
   - `com.cleanwhale.multi-crm-watcher.plist`
   - –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python 3.9+**
- **Playwright** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
- **EasyOCR** - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (–¥–∞—Ç—ã)
- **OpenCV** - –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–µ –∑—Ä–µ–Ω–∏–µ (–ø–æ–∏—Å–∫ –∫—Ä–∞—Å–Ω–æ–≥–æ badge)
- **Telegram Bot API** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **GitHub Actions** - CI/CD –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/ivanshyla/OrdersToTelegram.git
cd OrdersToTelegram/crm-watcher
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
playwright install chromium
```

### 3. –°–æ–∑–¥–∞—Ç—å `.env` —Ñ–∞–π–ª:
```bash
cp env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç—å:
```env
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
CRM_LOGIN_WARSAW=email@example.com
CRM_PASSWORD_WARSAW=password
CRM_LOGIN_BERLIN=email@example.com
CRM_PASSWORD_BERLIN=password
```

## üöÄ –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–æ (—Ä–∞–∑–æ–≤—ã–π):
```bash
cd crm-watcher
python3 multi_crm_monitor.py
```

### –õ–æ–∫–∞–ª—å–Ω–æ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —á–µ—Ä–µ–∑ launchd):
```bash
cd crm-watcher
./setup_service.sh
# –°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
```

### GitHub Actions:
Push –≤ `main` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è workflow.

## üìä –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

```mermaid
graph TD
    A[–ó–∞–ø—É—Å–∫] --> B[–û—Ç–∫—Ä—ã—Ç—å CRM —á–µ—Ä–µ–∑ Playwright]
    B --> C[–°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–∞—à–±–æ—Ä–¥–∞]
    C --> D[–ù–∞–π—Ç–∏ –¥–∞—Ç—É –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ OCR]
    D --> E{–î–∞—Ç–∞ –Ω–∞–π–¥–µ–Ω–∞?}
    E -->|–ù–µ—Ç| F[–û—à–∏–±–∫–∞]
    E -->|–î–∞| G[–ò—Å–∫–∞—Ç—å –∫—Ä–∞—Å–Ω—ã–π badge —Ä—è–¥–æ–º —Å –¥–∞—Ç–æ–π]
    G --> H{Badge –Ω–∞–π–¥–µ–Ω?}
    H -->|–î–∞| I[–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram]
    H -->|–ù–µ—Ç| J[–í—Å—ë –û–ö, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å]
```

## üé® –ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ—Ç–µ–∫—Ü–∏–∏ –∫—Ä–∞—Å–Ω–æ–≥–æ badge

1. **–ù–∞–π—Ç–∏ –¥–∞—Ç—É** —á–µ—Ä–µ–∑ EasyOCR (–Ω–∞–ø—Ä–∏–º–µ—Ä "22.11")
2. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ–±–ª–∞—Å—Ç—å –ø–æ–∏—Å–∫–∞**:
   - –ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª –∫–∞—Ä—Ç–æ—á–∫–∏
   - –®–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ ~250px
   - Badge –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ 170-250px –≤–ø—Ä–∞–≤–æ –æ—Ç –¥–∞—Ç—ã
3. **HSV —Ñ–∏–ª—å—Ç—Ä** –¥–ª—è –∫—Ä–∞—Å–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞:
   ```python
   H: [0-10] or [170-180]
   S: [150-255]
   V: [150-255]
   ```
4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç—É—Ä–æ–≤**:
   - –ü–ª–æ—â–∞–¥—å: 300-3000 –ø–∏–∫—Å–µ–ª–µ–π
   - Aspect ratio: 0.7-1.5 (–ø—Ä–∏–º–µ—Ä–Ω–æ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π)
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `True` –µ—Å–ª–∏ badge –Ω–∞–π–¥–µ–Ω

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
OrdersToTelegram/
‚îú‚îÄ‚îÄ crm-watcher/
‚îÇ   ‚îú‚îÄ‚îÄ multi_crm_monitor.py      # –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
‚îÇ   ‚îú‚îÄ‚îÄ badge_presence.py          # –ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ—Ç–µ–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ multi_crm_config.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt           # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ .env                       # –°–µ–∫—Ä–µ—Ç—ã (–Ω–µ –≤ git)
‚îÇ   ‚îú‚îÄ‚îÄ run_artifacts/             # –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ –ª–æ–≥–∏
‚îÇ   ‚îî‚îÄ‚îÄ com.cleanwhale.multi-crm-watcher.plist  # launchd
‚îú‚îÄ‚îÄ .github/workflows/
‚îÇ   ‚îî‚îÄ‚îÄ crm-monitor.yml            # GitHub Actions workflow
‚îú‚îÄ‚îÄ FINAL_FIX.md                   # –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
‚îî‚îÄ‚îÄ README.md                      # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:
- **GitHub Actions**: –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç, 8:00-22:00 UTC
- **Local (launchd)**: –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç

### –ß–∞—Å—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
```python
"notification_hours": [8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]
```
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–∏ —á–∞—Å—ã (–ø–æ timezone –≥–æ—Ä–æ–¥–∞).

### Cooldown –º–µ–∂–¥—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏:
```python
"alert_cooldown_minutes": 60
```
–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —Ç–æ–π –∂–µ –¥–∞—Ç—ã –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ —á–∞—Å.

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç:
```bash
cd crm-watcher
python3 multi_crm_monitor.py
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∫—Ä–∏–Ω—à–æ—Ç:
```bash
ls -lt run_artifacts/dash_*.png | head -1
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –¥–µ—Ç–µ–∫—Ü–∏–∏ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ:
```bash
python3 badge_presence.py --image run_artifacts/dash_warsaw_latest.png --target tomorrow
```

### –õ–æ–≥–∏ GitHub Actions:
```bash
gh run list --workflow=crm-monitor.yml --limit 5
gh run view <run_id> --log
```

### –õ–æ–≥–∏ launchd:
```bash
tail -f crm-watcher/launchd_multi.log
tail -f crm-watcher/launchd_multi.err
```

## ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–°–º. [`FINAL_FIX.md`](FINAL_FIX.md) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è false positives.

### –ö–ª—é—á–µ–≤—ã–µ —ç—Ç–∞–ø—ã:
1. ‚ùå –î–µ—Ç–µ–∫—Ü–∏—è –∫—Ä–∞—Å–Ω–æ–≥–æ badge (–ø–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è) - –º–Ω–æ–≥–æ false positives
2. ‚ùå –î–µ—Ç–µ–∫—Ü–∏—è –∂–µ–ª—Ç–æ–≥–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è - –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –≤—Å–µ—Ö –¥–∞—Ç
3. ‚ùå –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–∏—Å–µ–ª "–ö–æ–ª-–≤–æ" vs "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ" - –Ω–µ —Ç–æ –∂–µ —á—Ç–æ "—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã–µ"
4. ‚úÖ **–î–µ—Ç–µ–∫—Ü–∏—è –∫—Ä–∞—Å–Ω–æ–≥–æ badge –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –∫–∞—Ä—Ç–æ—á–∫–∏** - –†–ê–ë–û–¢–ê–ï–¢!

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

- **Telegram Bot**: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **GitHub**: [ivanshyla/OrdersToTelegram](https://github.com/ivanshyla/OrdersToTelegram)

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Private repository
